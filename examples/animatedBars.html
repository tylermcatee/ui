<body>
</body>

<script src="../utilities/float.js"></script>
<script src="../views/view.js"></script>
<script src="../animation/animation.js"></script>
<script src="../controllers/viewcontroller.js"></script>
<script src="../views/window.js"></script>

<script>

TOTAL_WIDTH = document.body.clientWidth;
TOTAL_HEIGHT = document.body.clientHeight;
TOTAL_BARS = 25;

class AnimatedBarsViewController extends ViewController {
    viewDidLoad() {
        super.viewDidLoad();
        
        this.barViews = [];

        for (var i = 0; i < TOTAL_BARS; i++) {
            this.barViews[i] = this.barViewForIndex(i, TOTAL_BARS);
            this.view.addSubview(this.barViews[i]);
        }

        setInterval(this.animateBars.bind(this), 800);
    }

    barViewForIndex(index, totalbars) {
        var barPadding = 10;
        var barWidth = (TOTAL_WIDTH / totalbars) - barPadding + (barPadding / totalbars);
        var xposition = barWidth * index + barPadding * index;

        var view = View.viewWithFrame(xposition, TOTAL_HEIGHT, barWidth, 0);
        view.setBackgroundColor('gray');
        return view
    }

    animateBars() {
        for (var i = 0; i < TOTAL_BARS; i++) {
            if (randBetween(0, 2) == 1) {
                var barView = this.barViews[i];
                Animation.animate(this.barViews[i], 0.4, function(view) {
                    var height = randBetween(0, TOTAL_HEIGHT) * .8;
                    view.setY(TOTAL_HEIGHT - height);
                    view.setHeight(height);
                    return view;
                });
            }
        }
    }
}

function randBetween(a, b) {
    return Math.floor(Math.random() * b) + a;
}

var viewController = new AnimatedBarsViewController();
Window.mainWindow().setRootViewController(viewController);

</script>